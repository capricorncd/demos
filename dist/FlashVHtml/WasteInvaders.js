const PIXI=window.PIXI,GAME=window.GAME;document.addEventListener("DOMContentLoaded",onReady),window.addEventListener("resize",resize),window.onorientationchange=resize,window.scrollTo(0,1);var loader,game,ratio,offsetX,offsetY,holder,loadInterval,width=800,height=600,isAdding=!1,mouseX=0,mouseY=0,loaderView=document.getElementById("loader"),loaderText=document.getElementById("loaderText"),loadCount=0,hasLoaded=!1,renderer=PIXI.autoDetectRenderer(600,800);window.renderer=renderer;var stage=new PIXI.Stage;window.stage=stage;var wasteLogo=new Image;wasteLogo.src="static/FlashVHtml/img/wasteLogo.png",wasteLogo.style.position="absolute",wasteLogo.style.top="0px",wasteLogo.style.left="0px",wasteLogo.style.display="none",wasteLogo.style.zIndex=20;var intro=new Image;intro.src="static/FlashVHtml/img/gameStartPanel.png",intro.style.position="absolute",intro.style.top="-240px",intro.style.left="0px",intro.style.display="none",intro.style.zIndex=200;var html5icon=new Image;html5icon.src="static/FlashVHtml/img/html5Logo.png",html5icon.style.position="absolute";var fullScreenIcon=new Image;fullScreenIcon.src="static/FlashVHtml/img/fullscreen_ON.png",fullScreenIcon.style.position="absolute",fullScreenIcon.style.cursor="pointer",fullScreenIcon.setAttribute("type","button"),fullScreenIcon.onmouseover=function(){fullScreenIcon.style.opacity=.5},fullScreenIcon.onmouseout=function(){fullScreenIcon.style.opacity=1};var canFullScreen=!1;function onReady(){(holder=document.getElementById("app")).appendChild(renderer.view),renderer.render(stage),document.body.scroll="no",(loader=new PIXI.AssetLoader(["static/FlashVHtml/img/floor.json","static/FlashVHtml/img/ActionAssets.json","static/FlashVHtml/img/hudAssets.json","static/FlashVHtml/img/vignette.png","static/FlashVHtml/img/EMP.png"])).addEventListener("loaded",(function(e){hasLoaded=!0,$(loaderView).fadeOut("slow",(function(){clearInterval(loadInterval),$(wasteLogo).fadeIn("slow",(function(){init(),$(wasteLogo).fadeOut("slow",(function(){}))}))}))})),document.body.appendChild(wasteLogo),holder.appendChild(intro),document.body.appendChild(html5icon),canFullScreen&&document.body.appendChild(fullScreenIcon),this.firstRun=!0,requestAnimFrame(loaderUpdate),loader.load(),$(loaderView).fadeIn(),resize()}function loaderUpdate(){loadCount+=.3,loadCount%=4;var e=Math.floor(loadCount);0==e?loaderText.src="static/FlashVHtml/img/gameLoading01.png":1==e?loaderText.src="static/FlashVHtml/img/gameLoading02.png":2==e?loaderText.src="static/FlashVHtml/img/gameLoading03.png":3==e&&(loaderText.src="static/FlashVHtml/img/gameLoading04.png"),hasLoaded||requestAnimFrame(loaderUpdate)}function init(){var e=(game=new GAME.ShootyEngine).view.renderer.view;e.style.position="absolute",stats=new Stats,stats.domElement.style.position="absolute",stats.domElement.style.top="0px",requestAnimFrame(update),$(holder).mousedown((function(e){e.preventDefault(),isAdding=!0,game.gamePlaying||(firstRun&&$(intro).fadeOut(300),game.restart())})),$(holder).mouseup((function(e){e.preventDefault(),isAdding=!1})),e.addEventListener("touchstart",onTouchStart,!0),e.addEventListener("touchend",onTouchEnd,!0),e.addEventListener("touchmove",onTouchMove,!0),$(holder).mousemove((function(e){mouseX=(e.pageX-offsetX)/ratio,mouseY=(e.pageY-offsetY)/ratio})),resize(),firstRun=!0,$(intro).delay(1e3).fadeIn(300)}function onTouchStart(e){e.preventDefault(),isAdding=!0,mouseX=(e.touches[0].clientX-offsetX)/ratio,mouseY=(e.touches[0].clientY-offsetY-30)/ratio,game.gamePlaying||(firstRun&&$(intro).fadeOut(300),game.restart())}function onTouchEnd(e){e.preventDefault(),isAdding=!1}function onTouchMove(e){e.preventDefault(),mouseX=(e.touches[0].clientX-offsetX)/ratio,mouseY=(e.touches[0].clientY-offsetY-30)/ratio}function resize(){var e=$(window).width(),t=$(window).height(),o=e/600,n=t/800;ratio=Math.min(o,n),offsetX=e/2-600*ratio/2,offsetY=t/2-800*ratio/2,game&&game.view.resize(600*ratio,800*ratio);var i=renderer.view;i.style.width=600*ratio+"px",i.style.height=800*ratio+"px",holder.style.left=e/2-600*ratio/2+"px",holder.style.top=t/2-800*ratio/2+"px",loaderView.style.left=e/2-40+"px",loaderView.style.top=t/2+"px",wasteLogo.width=287*ratio,wasteLogo.height=72*ratio,wasteLogo.style.left=e/2-wasteLogo.width/2+"px",wasteLogo.style.top=t/2-wasteLogo.height/2+"px",intro.width=439*ratio,intro.height=240*ratio,intro.style.left=600*ratio/2-intro.width/2+"px",intro.style.top=800*ratio/2-intro.height/2+"px",html5icon.width=41*ratio,html5icon.height=46*ratio,html5icon.style.left=e/2-600*ratio/2+10*ratio+"px",html5icon.style.top=10*ratio+"px",html5icon.style.zIndex=100,fullScreenIcon.width=142*ratio,fullScreenIcon.height=26*ratio,fullScreenIcon.style.left=e/2-600*ratio/2+10*ratio+"px",fullScreenIcon.style.top=764*ratio+"px",fullScreenIcon.style.zIndex=100}function update(){GAME.time.update(),game.mouse.x=mouseX,game.mouse.y=mouseY,game.isFiring=isAdding,game.update(),requestAnimFrame(update)}(document.body.mozRequestFullScreen||document.body.webkitRequestFullScreen)&&(canFullScreen=!0),fullScreenIcon.onclick=function(){document.body.mozRequestFullScreen?document.body.mozRequestFullScreen():document.body.webkitRequestFullScreen&&document.body.webkitRequestFullScreen()},Time=function(){this.deltaTime=1,this.lastTime=0},Time.constructor=Time,Time.prototype.update=function(){var e=Date.now(),t=e-this.lastTime;t>100&&(t=100),this.DELTA_TIME=.06*t,this.lastTime=e},GAME.time=new Time;